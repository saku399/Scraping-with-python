<div class="catalog-wrap">
  <h1 class="catalog-heading">Diatome Diamond Knives</h1>
  <div id="catalog" class="catalog-accordion">Loading…</div>
</div>

<script>
(async () => {
  const JSON_URL = 'https://saku-desktop.taile85236.ts.net/wordpress-6.8.1-ja/wordpress/wp-content/uploads/2025/09/test222.json';
  const CURRENCY = 'CAD';

  const $root = document.getElementById('catalog');

  const fmtPrice = (val) => {
    const n = Number(val);
    if (!Number.isFinite(n)) return '';
    try { return n.toLocaleString(undefined, { style:'currency', currency:CURRENCY }); }
    catch { return `${n.toFixed(2)} ${CURRENCY}`; }
  };

  const renderParent = (p) => {
    const name = p?.name || '';
    const desc = p?.desc || '';
    const subs = Array.isArray(p?.subproducts) ? p.subproducts : [];
    const img  = p?.image || (subs[0]?.image || '');

    const subsHTML = subs.map(sp => {
      const title = sp?.name || '';
      const price = fmtPrice(sp?.price);
      const url   = sp?.url || '#';
      return `
        <li class="sub-item">
          <a class="sub-link" href="${url}">
            <span class="sub-title">${title}</span>
            ${price ? `<span class="sub-price">${price}</span>` : ''}
          </a>
        </li>
      `;
    }).join('');

    return `
      <details class="parent-acc">
        <summary class="parent-summary">
          ${img ? `
            <div class="parent-thumb">
              <img loading="lazy" src="${img}" alt="${name ? `Image of ${name}` : 'Product image'}">
            </div>` : ''
          }
          <div class="parent-headings">
            <span class="parent-title">${name}</span>
            ${desc ? `<span class="parent-desc">${desc}</span>` : ''}
          </div>
        </summary>
        ${subs.length
          ? `<ul class="sub-list">${subsHTML}</ul>`
          : `<div class="no-subs">No subproducts available.</div>`
        }
      </details>
    `;
  };

  try {
    const res = await fetch(JSON_URL, { cache:'no-store' });
    if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);
    const data = await res.json();
    const items = Array.isArray(data?.products) ? data.products : [];
    $root.innerHTML = items.length ? items.map(renderParent).join('') : '<p>No products found.</p>';
    const first = $root.querySelector('details.parent-acc');
    if (first) first.open = true;
  } catch (e) {
    console.error(e);
    $root.innerHTML = '<p>Could not load products.</p>';
  }
})();
</script>

<style>
/* ===== Layout basics ===== */
/* =========================
   親（アコーディオンの見出し行）
   ========================= */
.parent-summary {
  /* 1行で「画像 | テキスト | 矢印」 */
  display: grid;
  grid-template-columns: auto 1fr auto;  /* 画像 | 伸びる本文 | 右端の矢印 */
  grid-template-areas: "thumb head arrow";
  align-items: start;                     /* 矢印を右上に揃えるため上寄せ */
  gap: 3rem;                              /* 画像とテキストの間隔は3rem */
  padding: 1rem;                          /* 上下左右すべて同じ */
  cursor: pointer;
}

/* ネイティブマーカーは消す（カスタム矢印を使う） */
.parent-summary::-webkit-details-marker { display: none; }

.parent-title {
  font-weight: 800;
  font-size: 1.12rem;
  color: #111;
  letter-spacing: .01rem;
}

.parent-desc {
  font-weight: 400;
  color: #555;
  line-height: 1.5;
}

/* 画像ブロック：正方形＋左に寄りすぎないようにも padding で調整済（親の1rem） */
.parent-thumb {
  /* すでに width: 180px, aspect-ratio: 1/1 などがある前提 */
  padding: 8px;                 /* ← 画像まわりに白余白を入れて品よく */
  background: #fff;             /* 白背景（透過PNGや余白に） */
  border: 1px solid #e6e6e6;    /* 薄い枠で締まりを出す */
  border-radius: 10px;          /* 少し角丸を強調（任意） */
  overflow: hidden;             /* 余白込みで角丸を効かせる */
}
.parent-thumb img {
  width: 100%;
  height: 100%;
  object-fit: contain;   /* ← 全体を収める（coverだと拡大トリミングでボケ/切れが出やすい） */
  image-rendering: auto; /* ブラウザ標準の高品質補間 */
  display: block;
}

/* タイトルの下に説明を縦積み。幅は残り全部 */
.parent-headings {
  grid-area: head;
  display: flex;
  flex-direction: column;
  gap: .35rem;
  min-width: 0;  /* 長文でも気持ちよく折り返す */
}

/* 右上の矢印：グリッドの右端セルに配置 */
.parent-summary::after {
  grid-area: arrow;
  content: "▾";
  align-self: start;      /* 上（右上） */
  justify-self: end;      /* 右（右上） */
  font-size: 1.2rem;
  color: #666;
  transition: transform .2s ease;
}
.parent-acc[open] .parent-summary::after {
  transform: rotate(180deg);
}

/* =========================
   サブ商品（黒い点を消す＆余白を上下左右同じに）
   ========================= */
.sub-list { 
  list-style: none; 
  margin: 0; 
  padding: .5rem 1rem 1rem; /* ここはリスト全体の外枠余白。必要なら調整OK */
}
.sub-list > li { list-style: none; margin: 0; padding: 0; }
.sub-list > li::marker { content: ''; }
.sub-list > li::before { content: none; }

/* カードとリンクの余白は上下左右すべて同じに */
.sub-item {
  border: 1px solid #eee;
  border-radius: 8px;
  background: #fff;
}
.sub-link {
  display: flex;
  justify-content: space-between; /* 左に名前、右に価格 */
  gap: 1rem;
  padding: 1rem;                  /* ← 上下左右おなじ */
  text-decoration: none;
  color: inherit;
}

/* スマホ時：1カラムでOK。矢印は右上キープ */
@media (max-width: 640px) {
  .parent-summary {
    grid-template-columns: 1fr auto;      /* 本文 | 矢印 */
    grid-template-areas:
      "thumb  arrow"
      "head   arrow";                      /* 画像→本文の順で縦に並び、矢印は右上 */
    gap: .75rem;
  }
  .parent-thumb { width: 100%; max-width: 420px; }
  .sub-list { grid-template-columns: 1fr; }
}
</style>
